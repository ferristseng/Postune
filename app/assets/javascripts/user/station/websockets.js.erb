var socket = io.connect('<%= "http://#{Settings['node']['host']}:#{Settings['node']['port']}/" %>');

socket.on("connect", function() {
	socket.emit("new user", { station: station, user: current_user });
});

socket.on("new song", function(data) {
	console.log(data);
	Player.load(data.path);
	$("#song-title").html((data.title != "") ? data.title : "Unknown");
	$("#song-artist").html((data.artist != "") ? data.artist : "Unknown");
	$("#song-album").html((data.album != "") ? data.album : "Unknown");
	$("#song-artwork").html((data.artwork != "") ? "<img src='" + data.artwork + "' alt='artwork' />" : "");
	Player.play();
});

socket.on("update user count", function(data) {
	$("#online-users").html(data);
});

socket.on("chat message", function(data) {
	if(data.type == "notification") {
		$("#chat-text").append("<div class='chat-message notification'>" + data.content.text + "</div>");
	} else if(data.type == "user") {
		$("#chat-text").append("<div class='chat-message user'>" + 
															"<span class='user'>" + data.content.user + ": </span>" + 
															"<span class='text'>" + data.content.text + "</span>" + 
														"</div>");
	}
})

socket.on("song play", function(data) {
	Player.load(data.song.path);
	Player.playOffset((new Date()).getTime() - data.time);
});

// Event Handlers
$(function() {
	$("#chat-form form").submit(function(e) {
		e.preventDefault();
		var input = $("#chat-form form input[type='text']");
		socket.emit("new message", $("<div/>").text(input.val()).html());
		input.val("");
	});
});